{"ast":null,"code":"import _regeneratorRuntime from \"/Users/admin/Desktop/GITHUB2021/blockchain_ecommerce_app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/admin/Desktop/GITHUB2021/blockchain_ecommerce_app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/admin/Desktop/GITHUB2021/blockchain_ecommerce_app/src/components/Store.js\";\nimport React from 'react';\nimport { ethers } from 'ethers';\nimport axios from 'axios'; // we use axios to make http requests to our backend \n\nvar API_URL = 'http://localhost:4000'; ////we define a variable to point to our backend. but if we deploy on heroku or fleek the URL will be different\n\nvar ITEMS = [//we also define a catalog of ITEMS\n{\n  id: 1,\n  price: ethers.utils.parseEther('100')\n}, {\n  id: 2,\n  price: ethers.utils.parseEther('200')\n}]; //we use the destructured props from the component in App.js in Store({})\n//we return our HTML/JSX as a list using the css bootstrap class list group\n\nfunction Store(_ref) {\n  var paymentProcessor = _ref.paymentProcessor,\n      dai = _ref.dai;\n\n  var buy =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(item) {\n      var response1, tx1, tx2, response2;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return axios.get(\"\".concat(API_URL, \"/api/getPaymentId/\").concat(item.id));\n\n            case 2:\n              response1 = _context.sent;\n              _context.next = 5;\n              return dai.approve(paymentProcessor.address, item.price);\n\n            case 5:\n              tx1 = _context.sent;\n              _context.next = 8;\n              return tx1.wait();\n\n            case 8:\n              _context.next = 10;\n              return paymentProcessor.pay(item.price, response1.data.paymentId);\n\n            case 10:\n              tx2 = _context.sent;\n              _context.next = 13;\n              return tx2.wait();\n\n            case 13:\n              _context.next = 15;\n              return new Promise(function (resolve) {\n                return setTimeout(resolve, 5000);\n              });\n\n            case 15:\n              _context.next = 17;\n              return axios.get(\"\".concat(API_URL, \"/api/getitemUrl/\").concat(response1.data.paymentId));\n\n            case 17:\n              response2 = _context.sent;\n              //1st we need to generate the paymentId from the backend. So we use axios to send a get request.\n              console.log(response2);\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function buy(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return React.createElement(\"ul\", {\n    className: \"list-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    className: \"list-group-item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 40\n    },\n    __self: this\n  }, \"Buy item1 - \", React.createElement(\"span\", {\n    className: \"font-weight-bold\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41\n    },\n    __self: this\n  }, \"100 DAI\"), React.createElement(\"button\", {\n    className: \"btn-success btn-lg float-right\",\n    onClick: function onClick() {\n      return buy(ITEMS[0]);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42\n    },\n    __self: this\n  }, \"BUY\")), React.createElement(\"li\", {\n    className: \"list-group-item\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45\n    },\n    __self: this\n  }, \"Buy item2 - \", React.createElement(\"span\", {\n    className: \"font-weight-bold\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46\n    },\n    __self: this\n  }, \"200 DAI\"), React.createElement(\"button\", {\n    className: \"btn-success btn-lg float-right\",\n    onClick: function onClick() {\n      return buy(ITEMS[1]);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47\n    },\n    __self: this\n  }, \"BUY\")));\n}\n\nexport default Store;","map":{"version":3,"sources":["/Users/admin/Desktop/GITHUB2021/blockchain_ecommerce_app/src/components/Store.js"],"names":["React","ethers","axios","API_URL","ITEMS","id","price","utils","parseEther","Store","paymentProcessor","dai","buy","item","get","response1","approve","address","tx1","wait","pay","data","paymentId","tx2","Promise","resolve","setTimeout","response2","console","log"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,MAAT,QAAuB,QAAvB;AACA,OAAOC,KAAP,MAAkB,OAAlB,C,CAAkC;;AAElC,IAAMC,OAAO,GAAG,uBAAhB,C,CAAgD;;AAEhD,IAAMC,KAAK,GAAG,CAA4B;AACxC;AACEC,EAAAA,EAAE,EAAE,CADN;AAEEC,EAAAA,KAAK,EAAEL,MAAM,CAACM,KAAP,CAAaC,UAAb,CAAwB,KAAxB;AAFT,CADY,EAKZ;AACEH,EAAAA,EAAE,EAAE,CADN;AAEEC,EAAAA,KAAK,EAAEL,MAAM,CAACM,KAAP,CAAaC,UAAb,CAAwB,KAAxB;AAFT,CALY,CAAd,C,CAUA;AACA;;AACA,SAASC,KAAT,OAA0C;AAAA,MAAzBC,gBAAyB,QAAzBA,gBAAyB;AAAA,MAAPC,GAAO,QAAPA,GAAO;;AAExC,MAAMC,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA,6BAAG,iBAAMC,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACcX,KAAK,CAACY,GAAN,WAAaX,OAAb,+BAAyCU,IAAI,CAACR,EAA9C,EADd;;AAAA;AACJU,cAAAA,SADI;AAAA;AAAA,qBAGQJ,GAAG,CAACK,OAAJ,CAAYN,gBAAgB,CAACO,OAA7B,EAAsCJ,IAAI,CAACP,KAA3C,CAHR;;AAAA;AAGJY,cAAAA,GAHI;AAAA;AAAA,qBAIJA,GAAG,CAACC,IAAJ,EAJI;;AAAA;AAAA;AAAA,qBAMQT,gBAAgB,CAACU,GAAjB,CAAqBP,IAAI,CAACP,KAA1B,EAAiCS,SAAS,CAACM,IAAV,CAAeC,SAAhD,CANR;;AAAA;AAMJC,cAAAA,GANI;AAAA;AAAA,qBAOJA,GAAG,CAACJ,IAAJ,EAPI;;AAAA;AAAA;AAAA,qBAWF,IAAIK,OAAJ,CAAY,UAAAC,OAAO;AAAA,uBAAEC,UAAU,CAACD,OAAD,EAAS,IAAT,CAAZ;AAAA,eAAnB,CAXE;;AAAA;AAAA;AAAA,qBAYgBvB,KAAK,CAACY,GAAN,WAAaX,OAAb,6BAAuCY,SAAS,CAACM,IAAV,CAAeC,SAAtD,EAZhB;;AAAA;AAYFK,cAAAA,SAZE;AAYqF;AAC7FC,cAAAA,OAAO,CAACC,GAAR,CAAYF,SAAZ;;AAbQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAHf,GAAG;AAAA;AAAA;AAAA,KAAT;;AAiBA,SACE;AAAI,IAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAI,IAAA,SAAS,EAAC,iBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACc;AAAM,IAAA,SAAS,EAAC,kBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADd,EAEE;AAAQ,IAAA,SAAS,EAAC,gCAAlB;AACQ,IAAA,OAAO,EAAE;AAAA,aAAKA,GAAG,CAAER,KAAK,CAAC,CAAD,CAAP,CAAR;AAAA,KADjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAFF,CADF,EAME;AAAI,IAAA,SAAS,EAAC,iBAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACc;AAAM,IAAA,SAAS,EAAC,kBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADd,EAEE;AAAQ,IAAA,SAAS,EAAC,gCAAlB;AACQ,IAAA,OAAO,EAAE;AAAA,aAAKQ,GAAG,CAAER,KAAK,CAAC,CAAD,CAAP,CAAR;AAAA,KADjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAFF,CANF,CADF;AAcD;;AAED,eAAeK,KAAf","sourcesContent":["import React from 'react';\nimport { ethers } from 'ethers';\nimport axios from 'axios';        // we use axios to make http requests to our backend \n\nconst API_URL = 'http://localhost:4000';        ////we define a variable to point to our backend. but if we deploy on heroku or fleek the URL will be different\n\nconst ITEMS = [                           //we also define a catalog of ITEMS\n  {\n    id: 1,\n    price: ethers.utils.parseEther('100')\n  }, \n  {\n    id: 2,\n    price: ethers.utils.parseEther('200')\n  }\n];\n//we use the destructured props from the component in App.js in Store({})\n//we return our HTML/JSX as a list using the css bootstrap class list group\nfunction Store({ paymentProcessor, dai }) {\n\n  const buy = async item=>{                         //here we need to create a buy() so that when we click the <button> it receives the ITEM[0] as the argument\n    const response1 = await axios.get(`${API_URL}/api/getPaymentId/${item.id}`);  //1st we need to generate the paymentId from the backend. So we use axios to send a get request. \n                                                                    //we need the API_URL then the endpoint api/getPaymentId/${item.id}\n    const tx1 = await dai.approve(paymentProcessor.address, item.price); //we approve the paymentProcessor.sol to spend our dai\n    await tx1.wait();                             //we wait for the tx to be mined.\n\n    const tx2 = await paymentProcessor.pay(item.price, response1.data.paymentId); //now we can send a 2nd tx to do the actual payment to the paymemtProcessor.sol. \n    await tx2.wait(); \n    \n    //Now we can request the dowload URL from the backend but we want to make sure\n    //but the backend needs time to listen to the payment event from the BC and update the payment status in mongoDB. \n      await new Promise(resolve=>setTimeout(resolve,5000)); //waits 5 seconds\n      const response2 = await axios.get(`${API_URL}/api/getitemUrl/${response1.data.paymentId}`);  //1st we need to generate the paymentId from the backend. So we use axios to send a get request.\n      console.log(response2);\n  };                                                \n\n\n  return (\n    <ul className=\"list-group\">\n      <li className=\"list-group-item\">\n        Buy item1 - <span className='font-weight-bold'>100 DAI</span>\n        <button className=\"btn-success btn-lg float-right\"\n                onClick={()=> buy (ITEMS[0])}>BUY</button>\n      </li>\n      <li className=\"list-group-item\">\n        Buy item2 - <span className='font-weight-bold'>200 DAI</span>\n        <button className=\"btn-success btn-lg float-right\"\n                onClick={()=> buy (ITEMS[1])}>BUY</button>\n      </li>\n    </ul>\n  );\n}\n\nexport default Store;"]},"metadata":{},"sourceType":"module"}